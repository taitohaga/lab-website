---
layout: "../../layouts/BlogPost.astro"
title: "Vimはいいぞ"
description: "最強 (所感) のテキストエディタ"
pubDate: "2021/5/21"
heroImage: "/lab/member/2109/images/vim-title.PNG"
---

## Vimとはなにか
最近、プログラミングをして遊ぶためのPCではメインのエディタとしてVimを用いてい
る。このPCは昨年度までは大学でも用いるためのメインPCとして使用していたが、今年
の4月ごろにLenovo PCを購入し、旧型機はUbuntuを入れることでLinux系環境で遊ぶマシ
ンとして転生した。

Ubuntuを使ってみた感想は気が向いたら書くけど、ここではUbuntuじゃなくてVimという
ものについて書きたい。**Vim**とは、40年以上前に開発されたテキストエディタviの改
良版である。UNIX環境でよく使われ、多くのLinuxディストリビューションで最初から使
える古めかしいエディタである。立ち位置としては、Windowsのメモ帳(Notepad)みたい
な感じ。これは本当に古めかしくて、まず起動すると、タイトル画面とともにチルダが
縦に並んでいる。

![MINGW64からVimを起動したところ](/lab/member/2109/images/vim-title.PNG)

このレトロな感じ、小学生の頃に熱狂した[プチコン](https://smileboom.com/special/petitcom/)を思い出すが、[最近のリッチなエディタ](https://azure.microsoft.com/ja-jp/products/visual-studio-code/)や[IDEのUI](https://www.jetbrains.com/ja-jp/pycharm/)に慣れた人々にとっては、とても受け入れがたい感じがするかもしれない。タイトル画面の雰囲気がすでにすごいというか、こういう感じのタイトル画面から起動するということそのものが時代遅れ感しかしないが、Vimの特徴は時代遅れなだけではない。Vimは**40年前に開発されたにもかかわらず100年以上先を行くUIを保有している。**

## h, j, k, l

起動画面を見てもらうと分かる通り、Vimにはボタンが一切ない。むしろマウスを使って
あちこちクリックしたところで何も反応しない。Vimではあらゆる操作をキーボードで完
結させることができる。Windowsのcmd.exeのように、すべてをコマンド入力で済ませる
エディタと思ってもらうのもいいが、Vimではカーソルキーすら使用することはない。画
面の中での移動はh, j, k, lで済ませる。タイピングガチ勢ならすぐに分かる通り、こ
の4つのキーはホームポジションに非常に近く右手だけで移動することができる。はじめ
は抵抗があるかもしれないが、実はこれが案外便利で、カーソルキーを触るために手を
動かす必要がないのである。テキスト編集、特にプログラミングにおいては、作業時間
の大半は文字入力と移動の繰り返しであり、移動のたびにカーソルキーに手を動かして
いたら動きに無駄が生じてしまう。Vimではそのようなことがないというわけだ。

気をつけるべきなのは、Vimを起動した直後は、**文字の入力はできない。**Vimには4つ
のモードがあり、最初はhjklによる移動やその他のコマンド、テキスト選択、検索など
に移行することができる**ノーマルモード**と呼ばれるモードになる。ノーマルモード
では文書での移動が可能であり、単純な4方向の移動以外にも、次のように便利なキーが
たくさん用意されている。

|     コマンド     |                                    意味                                    |
|:----------------:|:--------------------------------------------------------------------------:|
|    h, j, k, l    |                               左、下、上、右                               |
|       w, b       |                     次の単語の先頭へ、前の単語の先頭へ                     |
| t{char}, f{char} | 行内で次にその文字が登場する場所の直前まで移動、行内で次のその文字まで移動 |
|      0, \$       |                           行の先頭へ、行の末尾へ                           |
|       {, }       |                           前の段落へ、次の段落へ                           |
|      gg, G       |                     ファイルの先頭へ、ファイルの末尾へ                     |

上にあげたものは私が日頃よく使うもので、この他にも便利な移動キーがいくつもあ
る。

## 挿入モード
実際にテキストを入力するには、挿入モード(INSERT MODE)に切り替える必要がある。一
番手っ取り早く挿入モードに入るには、iと入力する。するといまのカーソルの位置から
文字を挿入することができる。あるいは、aと入力すると、カーソルの位置の次の位置に
文字を挿入することができる。挿入モードに入るにはとりあえず上の2つを覚えておけば
よいが、実用するには上の2つでは足りない。次のように、挿入モードに入るコマンドに
はいくつか種類がある。


| コマンド |                              意味                              |
|:--------:|:--------------------------------------------------------------:|
|   i, a   |       カーソルの位置から挿入、カーソルの次の位置から挿入       |
|   I, A   |                行の先頭から挿入、行の末尾に挿入                |
|   s, S   | カーソルの位置の文字を削除して挿入、現在行をすべて削除して挿入 |


また挿入モードからノーマルモードに切り替えるにはEscを押せばよい。挿入モード中で
もカーソルキーを使えばファイル内で移動ができるのだが、そのような使い方はおすす
めしない。次に述べるテキストオブジェクトを用いて、ノーマルモードと挿入モードの
切り替えをスムーズに行う。

## テキストオブジェクト
テキスト編集に関して、Vimには**テキストオブジェクト**という便利な機能がある。テ
キストオブジェクトとは、「単語(w)」「パラグラフ(p)」「タグ(t)」のような、テキス
ト内の一つの塊のことである。Vimでは、これらに対して「削除(d)」「ヤンク/コピー
(y)」「変更(c)」「大文字小文字切り替え(~)」といったオペレータを使うことで効率的
な編集を行うことができる。

全く意味がわからないと思うので、例をあげよう。例えば、diwと打てばカーソルがある
位置の単語を削除することができる。これはdが「削除」で、wが「単語」を指してい
る。iはinnerとかinsideとか呼ばれ、単語の部分だけを消してその周囲のスペースなど
は残すという意味である。コマンドの組み立て方は英語と似ていて、動詞と名詞を組み
合わせればよい。

同じように、ciwと打つと、カーソルがある位置の単語を消去した上で、挿入モードに入
ることができる。やはりこれもcが「変更」で、wが「単語」を意味している。iwの他に
awという指定方法もある。これでも単語をまるごと指定することができるが、iwとの違
いとして、単語を区切るスペースまで含むことができる。


![Vimスクショ](/lab/member/2109/images/vim-ciw-before.PNG)

この状態でciwと打つ

![Vimスクショ](/lab/member/2109/images/vim-ciw-after.PNG)

するとカーソルの位置にあった"common"が消えて、挿入モードに入る

パラグラフ(p)や二重引用符"でも同様である。cipとうつとパラグラフをまるごと消去し
て挿入モードに入ることができる。一方で、行全体に対してオペレータを適用させるに
は、オペレータコマンドを2回入力する。ddと打てば一行まるごと削除することができ、
yyと打てば一行まるごとコピーすることができる。ccと打てば一行まるごと削除して挿
入モードに入る。

### コマンドモード
コマンドモードでは、ファイル操作などができる。今までの説明では保存と読み込みが
一切できなかったが、ファイルの保存やファイルのオープンもコマンドで済ませること
ができる。通常のGUIエディタですらできるので当然である。


|            コマンド            |                                意味                                |
|:------------------------------:|:------------------------------------------------------------------:|
|          :q, :qa, :q!          |      終了、すべてのバッファを閉じて終了、保存せず強制的に終了      |
|               :w               |                                保存                                |
|           :e {path}            |                           ファイルを開く                           |
|     :sp {path}, :vs {path}     | 画面を横に分割してファイルを開く、画面を縦に分割してファイルを開く |
|      :tabe {path}, :tabn       |          新しいタブでファイルを開く、次のタブに切り替える          |
| :h, :h {keyword, tag, command} |   ヘルプを開く、キーワード・タグ・コマンドを指定してヘルプを開く   |



Vimのコマンドはすべて:(コロン)から始まる。これはコマンドモードに入るためのコマ
ンドであり、Vimのコマンドを記述するのにこの:から始めることが多い。

最後のモードとしてビジュアルモードがある。これはノーマルモードでv, V, Ctrl+Vと
打つことで切り替わることができる。テキスト選択に特化した機能で、これはこれで便
利である。大体の操作方法はテキストオブジェクトとオペレータの理屈と似通ってい
る。詳細は割愛する。例えばvipとすれば段落の内部をまるごと選択できる。

### カスタマイズ
以上に上げた他にも/で検索ができる、:%sで文字列置換ができるなど、便利な編集機能
がたくさんあり、この記事ですべてを丁寧に解説するほど私は暇ではない。ただ少しで
も、Vimというエディタが使いこなすと効率的でなおかつ**楽しい**ということがわかっ
ていただければと思う。

Vimは以上のような編集機能の他に、カスタマイズがそれなりに柔軟という特徴がある。
Vimの本来の編集機能は、コマンドが多く用意されているとはいえ、癖が強いのには変わ
りない。多くのVimmerはホームディレクトリに**.vimrc**という設定ファイルを自分で
置いて、Vimのインターフェイスをカスタマイズしている。例えば、次のように挿入モー
ドにおけるEscキーをjkと2つキーを入力するように**マッピング**することができる。

```
inoremap jk <Esc>
```

こうすることで、Escの他にjkと打つことでも挿入モードを抜けることができる。Esc
キーを用いて抜けてもよいが、ホームポジションから離れてしまうため、手元で人差し
指と中指を軽くローリングすることで簡単に挿入モードを抜けたほうがよい。このよう
なコマンドをVimを起動した直後に:をつけて入力しなければならないが、これを.vimrc
というファイルに書き込んでおくと、Vimがこのファイルを自動的に検出して、コマンド
を上から実行してくれる。すると、起動するたびにこのコマンドを入力する必要はなく
なるというわけである。

カスタマイズの幅は案外広く、このような単純なキーマッピング以外にも、行番号の表
示(set number)、リアルタイム検索 (set incsearch)、カーソルラインの表示(set
cursorline)など編集画面の細かいカスタマイズが可能である。

### プラグイン

Vimではプラグインも充実している。VimのカスタマイズにはVimが実行するスクリプト言
語である**VimScript**が利用可能である。VimScriptはほとんど通常のプログラミング
言語と同等の機能を有しており、地味にチューリング完全である。.vimrcを始めとして
Vimのカスタマイズは大抵このVim Scriptを用いて記述することができ、このプログラム
の集まりがVimのプラグインである。

Vimのプラグインは2000年代ごろから急速に増え始めた\[要出典\]。例えばVim上でディ
レクトリ表示ができるNerdTreeやfern.vim、自動補完機能や自動コンパイルを提供する
coc.nvim、VimからTwitterができるtwitvimなど、多種多様なプラグインが公開されてい
る。Vimはバージョン8移行でデフォルトでプラグイン管理の機能を保有するようになっ
たが、まだ機能が少ない。そのため、プラグインを管理するためのプラグインも多く公
開されている。そして多くのプラグインがGitHubで公開されるようになった。GitHubtの
リポジトリを.vimフォルダの所定の場所にクローンすれば簡単にそのプラグインを導入
でき、またアップデートも簡単に可能になる。便利な時代だなあ。

### 慣れの問題

効率的な編集ができると散々強調したが、やはり操作には癖がある。昔のソフトウェア
だから仕方ないと言う方がいるかも知れないが、viが開発された頃にはすでにマウスが
存在していたし、カーソルキーを用いたテキスト編集もその頃からすでに存在してい
た。要するに開発当初からしてviの操作性はかなり独特なもので、Vimになってもその独
特さは変わらない。

なので学習曲線はかなり急だと思われる。Unix系のシステムではほとんど必ず最初から
入っているテキストエディタであり、サーバ運営者にとっては非常にソフトウェアとは
いえ、敷居の高いツールである。gitのコミットメッセージやssh接続のときにデフォル
トで起動するソフトウェアであり、起動すると大抵の人には怖れられてしまう。しかし
ながらVimのファンは多く存在している。Stack Overflowが[2019年に行ったテキストエ
ディタのシェア率調
査](https://insights.stackoverflow.com/survey/2019#technology-_-most-popular-development-environments)
では、Vimの使用率は25%ほどで、**全体の5位にランクインしている。**十分にメジャー
なエディタと言える。VS Codeに大敗しているのは、Windows環境での導入が少々面倒く
さいからだろう。

![](./lab/member/2109/images/popular-editors.PNG)

最初はとっつきにくいVimであるが、使い続ければかなり手に馴染んでくる。むしろなぜ
Jupyter Notebookに挿入モードやノーマルモードがないのか逆に気になってしまうほど
である。WindowsでVimを導入するにはいくつか方法があるが、kaoriyaという方が配布し
ている日本語対応Vimを使ってみることをおすすめする。この通称kaoriya版Vimには、日
本語の単語の区切りを検出したり、ヘルプドキュメントを日本語化するプラグインが含
まれており、とても使いやすい。あるいはUnixライクな環境を再現するソフトウェア
(Cygwin, MINGW64, WSLなど)を使うのも良い。

- [kaoriya版Vimの配布ページ](https://www.kaoriya.net/software/vim/)
- [Vim公式](https://www.vim.org/)

余談：Vim以外のエディタを使うとjjjjjと入力して、「なんで移動しないんだ？」って
なりがち
