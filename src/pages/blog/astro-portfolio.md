---
layout: "../../layouts/BlogPost.astro"
title: "Astro + React + Tailwind CSSで個人ウェブサイトをリニューアル"
description: "Tailwind CSSが結構楽しい"
pubDate: "Oct 10 25"
heroImage: "/lab/member/2109/images/old-website.png"
---

# クソださウェブサイト

以前のゼミ用ウェブサイトは流石にダサすぎた。00年代のイラストレーターの個人サイトやポートフォリオでももう少しまともなデザインをしていただろうってくらいにダサすぎた。アクセスカウンターすら埋め込もうとしていない（まあ要らない）し、かつてのIEでもほぼ同じように表示できたんじゃないかというくらいにシンプルだった。

ダサいと言っても、単にHTMLのタグやCSSのプロパティを全然使いこなせていないとかそういう理由でダサかったわけではない。コンテンツが中央によるようにマージンを設定していた。Windows標準のイマイチなフォントが表示されないよう、フォントも自分で指定していた。コードブロックはちゃんとモノスペースのフォントファミリーを設定した。ウェブ技術に苦手意識をもつ私なりに、最低限のクオリティを担保した。しかし、所詮は見た目に気を使わないオタク気質な私が作ったウェブサイトだった。全然使いこなせないわけではないというが、白と黒以外の色をウェブサイトに使う気がさっぱりなく、様々な部分で作りが甘かった。服だけは妙に小慣れている気がするけど髪型がダサすぎる、みたいな感じ。

しかし、ここ最近インターンシップ参加などを通じて、このあたりの技術にある程度詳しくなれたので、練習とさらなる技術力の向上を狙って個人ウェブサイトを改修することに決めた。

# 使用する技術

ウェブサイトを改修するに当たり、どの技術を選定するかは様々な楽しさがある。仕事であれば要求仕様と突き合わせたりコストや工数を見積もったりするが、これは私の個人的なプロジェクトであり1円にもならない作業なので、私が最近注目しているフレームワークや個人的に使い慣れているものを使っていくことにした。

メインで使うのは記事のタイトルに上がっているこの3つになるわけだが。

## Astro

https://astro.build

今回の主役である。今回採用している他の技術スタックの中では新し目のプロジェクトのようで、私も最近知った。英語の情報はまだまだ少なく、日本語の情報など皆無だが、静的ウェブサイトを手軽に作るにはなかなか扱いやすいフレームワークなんじゃないかと思い、使ってみることにした。

なんといっても、静的ウェブサイトの構築に特化して、サイト生成の際に極力JavaScriptを排除しようとする設計思想が特徴だろう。公式サイトではAstro Islands Architectureと表現され、ウェブサイトのうち必要な部分にだけJavaScriptを実行させるようにビルドの段階で最適化してくれる。

ReactおよびNext.jsはクライアントサイドでのJavaScriptの実行を前提とした上で、ユーザにコンテンツを展開する。HTMLウェブページとスタイルシート、スクリプトを一旦サーバから受け取ったら、それ以降のデータのやり取りは別のHTMLページでなくAPI通信で行う。これはよくSPA (Single Page Application)と表現される。ブラウザで動く様々なアプリは、ブラウザ上でスクリプトを実行し、必要なデータなどはAPI通信でやり取りすることで、ページを書き換えている。

対して、Astroは単一のページでなく複数のページを作り、サーバ側でルーティングを処理する。Astroのページをホストするサーバでは公開フォルダが作成され、そこにウェブページのデータが配置される。この方式は実装や簡単でサーバ・クライアントともに要求されうスペックが非常に低い。ただその分、インタラクティブなUIを構築しようとすると制限がかかってしまう。

私としては、たかが個人ウェブサイトに単一ページでリッチなUIを持たせる必要もないし、そもそもゼミのウェブサイトというプラットフォームはPHP以外非対応なので、そこまでなにか重厚なコンテンツを作る気になれなかった。要するに、「Astroほどの軽量なウェブサイトで十分」と思った。管理者権限やターミナルもいじれない上に、Nginxの設定ファイルも触らせてもらえないので、やれることはそんなに多くなかった。

## React

Astroは部分的にJavaScriptを取り込ませることができる。SPAを開発する気はないが、かといってReactは結構便利だった。特にヘッダーなどのUIコンポーネントを記述するのによさそうだと思ったので、今回はReactも導入した。

Astroはその他のフレームワークと統合することができる。このあと紹介するTailwind CSSも使えるし、React以外のUIフレームワークも使える。今回はまさかの物理サーバへのデプロイだったので必要なかったが、各種クラウドサービスにデプロイするためのアダプターなども提供されている。

個人的に、宣言的UIの利便性を徐々に感じ始めてはいる。例えばPythonやJavaといったプログラミング言語でUIを構築しようとすると、コードが複雑になりすぎていたが、Reactなどであれば複雑にはなりすぎず、画面全体の見通しが向上するように思う。

## Tailwind CSS

最近話題の賛否両論あるCSSフレームワークがこちらである。

「ユーティリティ・ファースト」を謳っており、`class` や `className` に特定のクラスを当てていくことで、対応するCSSプロパティをてきようすることができるというものである。

例えば、Tailwind CSSを導入した状態でこのように書いたとする。

```html
<div class="bg-red-600">
	Hello
</div>
```

これはすなわち、以下のようなCSSプロパティを当てたのに相当する。

```css
bg-red-600 {
	background-color: #dc2626;
}
```

これによりCSSファイルの記述量が減り、さらに全体的にクラス名も短縮されて定義してあるので、スタイルの記述がある程度お手軽かつ高速になる。

私の知っている範囲だと、この手のプラグインでは他にもBootstrapというものがあった。Tailwind CSSはBootstrapよりも自由度が高く便利だとは思うものの、本来のCSSに比べると当然スタイルの幅は狭まってしまう。デフォルトでもそれなりに使えるが、例えば円状のグラデーションを追加したいと思ったら、`tailwind.config.cjs`をいじらないといけない。

```javascript
module.exports = {
  theme: {
    extend: {
      backgroundImage: {
        'gradient-radial': 'radial-gradient(var(--gradient-color-stops))',
      }
    }
  }
}
```

https://github.com/tailwindlabs/tailwindcss/discussions/2599 より引用

また、本来のCSSを「極力書かせない」ようなフレームワークであるので、初心者には勧められない。

今回私は、スタイルシートをいっぱい書いて再現したい凝ったデザインも特にないのでTailwind CSSを採用した。とりあえずいい感じになればいいんだ。あとBootstrapは昔使ったから、今度は別のやつを使ってみたい、というのもある。

# 開発の工程

以上の技術を使うということを確認した上で、プロジェクトを作成した。

## プロジェクトの雛形

最近では新しく作成するアプリやウェブサイトについては、ボイラープレートを用いることもかなり多いと思う。例えば、Reactなら次のようなコマンドで手軽にReactアプリの雛形を作ってしまう。

```sh
yarn create react-app my-app
```

同じようなコマンドがAstroにもある。

```sh
yarn create astro
```

コマンドを実行すると、セットアップウィザードが始まり、ディレクトリ名、一緒に導入するフレームワーク、TypeScript使用などのオプションを設定できる。このような開発体験は私も結構好きである。昨今のコマンドラインツールは絵文字を表示したり見やすいシーケンスバーを表示したりと、256色の文字しか表示できない黒い画面を少しでも鮮やかにしようとしてくれているかのようだ。

このユーティリティの特徴としては、作成するウェブサイトのテンプレートを指定できることだろうか。

```
? Which template would you like to use? > - Use arrow-keys. Return to submit.
>   Just the basics (recommended)
    Blog
    Portfolio
    Documentation Site
    Empty project
```

こういう初心者に優しい（？）プロンプトも私は嫌いじゃない。これから楽しい開発体験が待っている！と開発者に期待させるような、良い演出だと私は思う。ターミナル上のプログレスバーが虹色に光るのも見ていて楽しい。Astroを使った開発者はなぜか Astronaut (宇宙飛行士) と呼ばれるのも、VTuberのファンにファンネームが存在するみたいなノリがあってなんだかワクワクする。

## ディレクトリ構成

プロジェクトを作成したら、ディレクトリに `cd` して依存関係をインストールして、開発サーバを立ち上げてみよう！と丁寧な導入が出力される。

```sh
cd my-astro-site
yarn
yarn start
```

開発用サーバを立ち上げて http://localhost:3000 にアクセスすると、~みんなの卒論のように~まっさらなウェブページが表示される。あまりにもまっさらで何にもない。私のような美的センス皆無の人間にこのようなまっさらなものを渡したら成果物もまっさらなのだが、それではリニューアル前と同じになってしまうので、スタイルシートについてはあとから考えることにする。

テンプレートからAstroのリポジトリを作成すると、最初からいくつかのディレクトリや設定ファイルが生成される。

- `src/*`: ソースコードが含まれる。
- `public/*`: ソースコードでない静的アセット。画像やフォントなど。
- `package.json`: プロジェクトの設定などが含まれる。JavaScriptのプロジェクトではおなじみのJSONファイル。
- `astro.config.mjs`: Astroのconfigファイル。
- `tsconfig.json`: TypeScriptを選択した場合に作成される。TypeScriptのトランスパイル時のオプション。

`src/*` ディレクトリの中身は次のような構造になる。

- `src/components/`: コンポーネント (部品) を配置する。
- `src/layouts/`: ページテンプレートを配置する。
- `src/pages/`: ページ本体を配置する。このディレクトリのファイル構造がほぼそのまま出力先のウェブサイトのルーティング構造になる。
- `src/styles/`: スタイルシートを配置する。

## Astroファイル

さて、Astroでは`.astro`ファイルという独自のマークアップ言語を用いてウェブサイトを記述することができる。`.astro`ファイルの構造はこのような感じで、モジュール拡張機能付きのJavaScript / TypeScriptのコード記述とHTMLを一緒に並べて書くような感じの見た目をしている。

```astro
---
import BaseHead from "../components/BaseHead.astro";
---

<html lang="ja">
	<head>
		<BaseHead />
	</head>
	<body>
		<h1>Hello</h1>
	</body>
</html>
```

見ての通り、ハイフンで囲まれた部分はJavaScriptのコードであり、その下はHTMLである。しかしこのJavaScriptのコードは、出力結果にスクリプトとしてバンドルされるのではなく、静的サイトに変換される。このあたりはReactのJSX記法とは前提条件が異なってくる。どちらかというとMarkdown形式の先頭に書くfrontmatterのほうが概念的に近い。

なので、クライアントサイドでスクリプトを実行するには、そのことをしっかりと明示するような設定を書かなければならない。通常のHTMLと同じように `<script>` が使えるので、それをテンプレート部分に記述するのも一つの方法である。他にもUIフレームワークと統合することでブラウザにJavaScriptを実行させることができる。

## React導入

今回、私はテーマのトグルスイッチを実装するのにReactが必要だった。別になくてもコンテンツサイトとしては機能するのだが、ダークモードに変更できたほうが目が疲れないだろうというちょっとした親切心である。

Astroはすでに様々な拡張機能が使えるようになっており、Reactの他にVueやAngularなど有名なUIフレームワークを導入することができる。

```sh
yarn astro add react
```

これだけでReact自体のインストールだけでなく、`astro.config.cjs`といった設定ファイルまで変更を加えてくれる。手動のインストールもそこまで複雑でなく、`@astrojs/react`, `react`, `react-dom`をyarnやnpmでインストールし、`astro.config.cjs` に追記するだけなのだが。

```javascript
import react from '@astrojs/react';

export default {
  // ...
  integrations: [react()],
}
```

## Tailwind CSS 導入

Tailwind CSSも拡張機能として手軽に統合可能である。

```sh
yarn astro add tailwind
```

これだけでユーティリティ・ファーストなスタイリング体験が可能である。特にレスポンシブ対応やダークモードの切り替えを実装する際のコード記述量がかなり少なくなったように感じる。というのも、例えば選択中のテーマに応じて `<main>` タグの背景とテキストの色を変更したい場合、次のように書くだけで良いのだ。

```html
<body class="bg-amber-50 dark:bg-stone-700 box-border text-slate-800 dark:text-slate-200 transition-colors duration-250" >
  <slot />
</body>
```

ここでは `dark:` という接頭辞がダークモードの場合に適用すべきスタイルであることを明示している。さらに色が変更された際のアニメーションも `transition-colors` と `duration-250` で記述しており、これだけで色がゆっくりと変化するアニメーションが適用される。

Tailwind CSSらしくクラスの数が恐ろしいことになっているが、なんかそろそろ慣れてきた気がする。同じことをCSSで実装しようとすると十数行のコードになるが、それをここまで短く書けるため、開発スピードは間違いなく上がる。特に私はオリジナルのCSSで完璧に再現したいデザインもないので、本当にこれで要件は満たせると思う。注意するべき点として、どういうクラスを書いたらどのような**CSSのプロパティが当てられるのか**をしっかり把握する必要がある。

## ランディングページ

ウェブサイトを訪れたときに最初に見るページは、ランディングページと呼ばれ、マーケティングの文脈ではかなり力を入れて作成されるようだ。私も少しでも私という人間の個人サイトに迷い込んだちゃんちゃらおかしい人々に楽しんでもらうために、インパクトのあるランディングページに仕上げたいと考えた。

このとき、どのようなことを書くか本当に迷った。例えば、巷のポートフォリオの例を眺めてみると、なにやらキャッチフレーズのようなものが書かれている場合がある。その一言は、そのサイトの人物がどのような職業や考えの人間で、どのような気持ちで仕事をしていきたいかなどを一言で表さんとする、いうなれば**座右の銘**のようなものが提示されるのだ。

これはこれで面白いが、私は座右の銘は書かなかった。私はシンプルに、そのへんのマイナーなSNSのユーザホームみたいなデザインで通すことにした。ただ、シンプルに自分の顔面を掲載しても何も面白くないので、友人が勝手に作成した用途不明の素材を使わせてもらった。

![謎素材](/lab/member/2109/me.jpg)

この眼力だけで十分インパクトはあると思うので、これ以上奇抜なことはせず、あとはシンプルにサイトのコンテンツへの誘導リンクと私の簡単なプロフィールのみを、色彩やデザインに気を使いながら書いていった。

このランディングページを作成する過程で、ウェブサイトの全体的なデザインも決定した。メインで使う色として薄めの青 (しばしば私に合う色としてあげられる) を採用し、ベースは薄い黄色を選んだ。ダークモードでは青は濃いものにし、黒は黒すぎないものを選んだ。こうして、まるで大学の数学の先生のスライド資料のようなデザインが完成したのである。BeamerでいうMadridとかそのあたりかな？

## テーマのトグルスイッチ

先に述べた通り、トグルスイッチをReactで実装した。クライアントサイドでスクリプトを実行させるにはAstroでも実現可能だが、Reactのほうが書きやすいと思った。Tailwindでは `dark:` 接頭辞に指定したデザインがダークモードの時に有効になる。

トグルスイッチの実装方法の方針は、Tailwindの公式ドキュメントにわかりやすい説明が載っているのでそれを参考にすることができる。

https://tailwindcss.com/docs/dark-mode

ネイティブのCSSでは`prefers-color-scheme`メディアクエリで、システムのカラースキームを検出して、ダークモードに自動スイッチできる。今回はユーザの好みでこれを自由に変更できるようにしたいので、以下のようにドキュメントのルート要素にクラスを追加したり削除したりする方法を取る。

```js
  const [theme, setTheme] = useState(() => { /* ... */});
  useEffect(() => {
    const root = document.documentElement;
    if (theme === 'light') {
      root.classList.remove('dark');
    } else {
      root.classList.add('dark');
    }
  }, [theme]);
```

これはテーマトグルスイッチのコンポーネントの内部のコードである。 今回はテーマの設定は`localStorage`に保存する戦略を取っており、 `theme` の初期値は最初にこの`localStorage`を参照する。値が見つからなければシステムのカラースキームを参照し、それも見つからなければ、適当に`light`とかで初期値を決め打ちする、というスタイルだ。

ページを読み込んだときに、`localStorage` を参照して、自動でカラーを変更する処理も追加しておく。こうしておかないといったんライトモードでコンポーネント全体をレンダリングして、`localStorage` が書き換えられたときに `useEffect` が発火してダークテーマが適用されたりしてしまう。表示のされ方としては、さっきまでダークモードだったのに、ページ遷移をしたら一旦全体が明るくなって、また暗くなるという感じになるため、目に悪い。

```js
<script is:inline>
    const root = document.documentElement;
    const localStorageTheme = localStorage.getItem('theme');
    if (localStorageTheme !== null) {
        if (localStorageTheme === 'light') {
            root.classList.remove('dark');
        } else {
            root.classList.add('dark');
        }
    }
</script>
```

## プロフィールページ

自信の経歴や使ったことのある言語・フレームワークについてまとめたページを"About"としてサイトに置いておく。大抵のブログサイトのライターの自己紹介には書き手の赤裸々な思いや好きなことについて割りと自由に書き連ねたりしているが、私はそういう赤裸々な思いをブログのエントリーにバンバン載せているので、特に面白みのない履歴書スタイルで書き上げた。

自画像を投入したいが、さすがにさっきの眼光を使い回すのは気が引けたので、自分のGoogle Photosを探索した。だがいくら探しても自分が椅子に座ってキーボードを叩きコーディングに勤しんでいるカットが見つからない。代替手段として、初代プレステぶりにゲーセンで「電車でGO」を楽しんでいる私の画像を貼り付けておいた。電車でGOだと言わなければなにやら薄暗い部屋で複数のディスプレイに囲まれながらハッキング的なことをしているように見えなくもない。単にローディング画面が表示されているだけなのだが。

![ハッカー?](/lab/member/2109/me-operating-train.jpg)

## 既存コンテンツを移行

あとは旧ウェブサイトの移行を行う。

Astroを選んでみた特徴の一つとして、Markdown形式のページをシームレスに静的ウェブサイトとして出力する事ができるオールインワンのフレームワークであるという点が挙げられる。別の場所でも書いたかもしれないが、私は基本的にHTMLを書くのを面倒くさがっている。代わりに記事の内容にフォーカスしたMarkdown形式を好んでおり、これまでずっとMarkdownでブログを書く方法を模索し続けてきた。Markdownパーサの自作に始まり、Pandocの発見、MarkdownとLaTeX / PDFの変換やMarkdownによるスライド資料作成など、これまで効率性を重視した~無駄な~努力を重ねてきた。Astroの選定はこの営みの（現時点での）最終形態とも言える。

記事の本文そのものをいじる必要はなかったが、苦労したのは画像の表示である。画像のパスの設定には気を使う必要があり、Markdown形式でページを作成すると、Astroは `public` ディレクトリにある画像に対する絶対パスでしか画像を読み込んでくれない。しかし既存のMarkdownファイルの画像のパス指定は記事からの相対パスで書かれていたので、これを調整する必要があった。このあと実際のサーバにデプロイするときも画像やCSSアセットなどで一悶着あったのだが、このあたりは**Vimの優秀な編集機能により**そこまで苦労せずに修正できた。

## デプロイ

最終的なウェブページを出力するには `yarn build` コマンドを用いる。すると予め設定したディレクトリ (デフォルトでは `dist/`) にHTMLファイルやJSファイルが生成される。これをサーバに持っていけば基本的にウェブサイトとして正常に表示されるはずである。

生成されたコードを見てみると、JavaScriptの変数名が一文字だったり、そもそも改行もインデントもされていなかったりと、明らかに機械的に生成したような見た目をしている。人間はAstroファイルやReactの書き方でウェブページを記述し、成果物は人間が読むのを想定しない効率重視の形式で出力される。

ちょっと引っかかった点として、ローカルサーバで開発するときは `http://localhost:3000/` でホストしていたので、`<a>` リンクや `<img>` のパスなどをルート `/` を起点にして書けばよかったのだが、ゼミのサーバにホストするとルートは `/lab/member/2109/` になるので、先程のリンクや画像へのパスはこれをすべてパスの直線に書いて指定しないといけなかった。

編集作業自体は最強 (所感) のテキストエディタを使用しているのでそこまで大変ではない (これを使い慣れていない GUIエディタでやっていたらどうなっていたことだろう) が、今度はローカルサーバで画像が表示されなかったりビルドがうまくいかなかったりすることが懸念される。

その場合は `astro.config.mjs` を編集して、次のようにすればよい。

```js
export default defineConfig({
  site: 'http://kawai.onamaeweb.jp',
  base: '/lab/member/2109',
  /* --- snif --- */
})
```

個人的にはReact Routerのように、ルーティングの起点 (ここでは `base` 属性) を変更すれば、サイト内部のルーティングやパス指定もビルド時に自動で調整してくれる機能があればいいなあと思う。ただAstroは独自のルーティングライブラリを持たず、ブラウザネイティブの `<a>` を使わせると書いてあったので、そのような使い方は想定していないのかもしれない。  今のところこのような一工夫はGitHub Pagesくらいしか使い所がなさそうだ。

`dist/` に生成されたファイルたちをそのままサーバに転送すればデプロイ完了なのだが、以前は自作の[Pythonスクリプト](https://github.com/taitohaga/ftpu)を導入してコマンド一行で一括更新していた。今回もそうしようと思ったのだが、Pythonのスクリプト本体を実行するためのバッチファイルを作成してパスを通して `package.json` にスクリプトを登録するのがちょっと面倒だったので、シンプルにFFFTPを使った。このあたりの設定もそのうち整えるつもりではある。理想としては、こんな感じでYarnと統合してコマンド一行でデプロイまで自動化したい。

```sh
yarn deploy
> cd dist && ftpu update
```

# 成果物

ついに完成したのが今皆さんが見ているこのウェブサイトである。ライトモードは背景に黄色を選択してポップ（？）な感じを演出し、ダークモードは一気にギークな雰囲気に仕立てた。

![新しいウェブサイト](/images/new-website.png)

なかなか出来は悪くないんじゃないかと思う。以前のあのデザインに比べて色が増え、全体的に見やすくなった。もちろんレスポンシブ対応で、スマホで開くとヘッダーメニューの文字が消失したり、コンテンツが縦一列に並んだりする。モードトグルスイッチもちゃんと動いているはずだ。